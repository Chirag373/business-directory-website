{% extends "base.html" %}
{% load static %}

{% block title %}Promoter Signup - Business Directory 2.0{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/signup_shared.css' %}">
<link rel="stylesheet" href="{% static 'css/promotor_signup.css' %}">
{% endblock %}

{% block content %}
<section class="profile-section">
  <h2 class="profile-title">Promoter Registration</h2>
  <p class="profile-subtitle">Create your account to offer products and promotional offers</p>

  <!-- Progress Indicator -->
  <ul class="progress-indicator">
    <li class="progress-step completed">
      <div class="progress-number">1</div>
      <div class="progress-label">Account Type</div>
    </li>
    <li class="progress-step active">
      <div class="progress-number">2</div>
      <div class="progress-label">Business Details</div>
    </li>
    <li class="progress-step">
      <div class="progress-number">3</div>
      <div class="progress-label">Confirmation</div>
    </li>
  </ul>
  
  <div class="alert-box">
    <p><strong>Note:</strong> Our system requires you to have a business card. If you do not have one, the system cannot
      sign you up.</p>
  </div>

  <div class="premium-note">
    <p><strong>Important:</strong> If you also provide handyman services, you will need to sign up for both a Promoter
      account and a Handyman account (2 separate subscriptions).</p>
  </div>

  <form class="profile-form" method="post" action="{% url 'promotor_signup' %}" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="form-section">
      <h3 class="section-title">Personal Information</h3>

      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="first-name" class="form-label">First Name</label>
            <input type="text" id="first-name" name="first_name" class="form-control" required>
          </div>
        </div>

        <div class="form-col">
          <div class="form-group">
            <label for="last-name" class="form-label">Last Name</label>
            <input type="text" id="last-name" name="last_name" class="form-control" required>
          </div>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3 class="section-title">Business Information</h3>

      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="business-name" class="form-label">Business Name</label>
            <input type="text" id="business-name" name="business_name" class="form-control" required>
          </div>
        </div>

        <div class="form-col">
          <div class="form-group">
            <label for="website" class="form-label">Website URL</label>
            <input type="url" id="website" name="website" class="form-control" placeholder="https://example.com">
          </div>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3 class="section-title">Contact Information</h3>

      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="email" class="form-label">Email Address</label>
            <input type="email" id="email" name="email" class="form-control" required>
          </div>
        </div>

        <div class="form-col">
          <div class="form-group">
            <label for="phone" class="form-label">Phone Number</label>
            <input type="tel" id="phone" name="phone" class="form-control" required>
          </div>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3 class="section-title">Business Address</h3>

      <div class="form-row">
        <div class="form-col" style="flex: 0.3;">
          <div class="form-group">
            <label for="address-number" class="form-label">Address Number</label>
            <input type="text" id="address-number" name="address_number" class="form-control" required>
          </div>
        </div>

        <div class="form-col" style="flex: 0.7;">
          <div class="form-group">
            <label for="address" class="form-label">Street Address</label>
            <input type="text" id="address" name="address" class="form-control" required>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="state" class="form-label">State</label>
            <select id="state" name="state" class="form-control" required>
              <option value="">Select State</option>
              <option value="AL">Alabama</option>
              <option value="AK">Alaska</option>
              <option value="AZ">Arizona</option>
              <!-- More states would be listed here -->
            </select>
          </div>
        </div>

        <div class="form-col">
          <div class="form-group">
            <label for="county" class="form-label">County</label>
            <select id="county" name="county" class="form-control" disabled required>
              <option value="">Select County</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="city" class="form-label">City</label>
            <select id="city" name="city" class="form-control" disabled required>
              <option value="">Select City</option>
            </select>
          </div>
        </div>

        <div class="form-col">
          <div class="form-group">
            <label for="zip" class="form-label">ZIP Code</label>
            <input type="text" id="zip" name="zip" class="form-control" required>
          </div>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3 class="section-title">Business Card</h3>
      <p>Please upload images of your business card</p>

      <div class="file-upload-container">
        <div class="form-group">
          <label for="card-front" class="form-label">Front Side (Required)</label>
          <input type="file" id="card-front" name="card_front" accept="image/*" class="form-control" required>
        </div>
        <div class="card-preview" id="front-preview">
          <span class="card-preview-text">Preview will appear here</span>
        </div>
      </div>

      <div class="file-upload-container">
        <div class="form-group">
          <label for="card-back" class="form-label">Back Side (Optional)</label>
          <input type="file" id="card-back" name="card_back" accept="image/*" class="form-control">
        </div>
        <div class="card-preview" id="back-preview">
          <span class="card-preview-text">Preview will appear here</span>
        </div>
      </div>

      <div class="checkbox-container">
        <input type="checkbox" id="blank-back" name="blank_back">
        <label for="blank-back" class="checkbox-label">Check this if your business card backside is blank</label>
      </div>
    </div>

    <div class="form-section">
      <h3 class="section-title">Product Information</h3>

      <div class="form-group">
        <label class="form-label">Select product categories you offer:</label>
        <div class="services-container">
          <div class="checkbox-container">
            <input type="checkbox" id="building-materials" name="product_categories" value="building_materials">
            <label for="building-materials" class="checkbox-label">Building Materials</label>
          </div>
          <div class="checkbox-container">
            <input type="checkbox" id="plumbing-supplies" name="product_categories" value="plumbing_supplies">
            <label for="plumbing-supplies" class="checkbox-label">Plumbing Supplies</label>
          </div>
          <div class="checkbox-container">
            <input type="checkbox" id="electrical-supplies" name="product_categories" value="electrical_supplies">
            <label for="electrical-supplies" class="checkbox-label">Electrical Supplies</label>
          </div>
          <div class="checkbox-container">
            <input type="checkbox" id="flooring-products" name="product_categories" value="flooring_products">
            <label for="flooring-products" class="checkbox-label">Flooring Products</label>
          </div>
          <div class="checkbox-container">
            <input type="checkbox" id="paint-supplies" name="product_categories" value="paint_supplies">
            <label for="paint-supplies" class="checkbox-label">Paint & Supplies</label>
          </div>
          <div class="checkbox-container">
            <input type="checkbox" id="appliances" name="product_categories" value="appliances">
            <label for="appliances" class="checkbox-label">Appliances</label>
          </div>
          <div class="checkbox-container">
            <input type="checkbox" id="tools" name="product_categories" value="tools">
            <label for="tools" class="checkbox-label">Tools</label>
          </div>
          <div class="checkbox-container">
            <input type="checkbox" id="garden-supplies" name="product_categories" value="garden_supplies">
            <label for="garden-supplies" class="checkbox-label">Garden Supplies</label>
          </div>
          <div class="checkbox-container">
            <input type="checkbox" id="home-decor" name="product_categories" value="home_decor">
            <label for="home-decor" class="checkbox-label">Home Decor</label>
          </div>
          <div class="checkbox-container">
            <input type="checkbox" id="other" name="product_categories" value="other">
            <label for="other" class="checkbox-label">Other</label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="product-description" class="form-label">Product Description</label>
        <p class="form-note">Please use precise keywords for your products.</p>
        <textarea id="product-description" name="product_description" class="form-control" required></textarea>
      </div>
    </div>

    <div class="subscription-info">
      <h4>Premium Account - $24.99/month</h4>
      <p>Your promoter account gives you access to our platform to reach customers and offer your products and promotional deals.</p>
    </div>

    <div class="navigation-controls">
      <a href="{% url 'register' %}" class="back-btn"><i class="fas fa-arrow-left"></i> Back</a>
      <button type="submit" class="submit-btn">Submit <i class="fas fa-check"></i></button>
    </div>
  </form>
</section>

<!-- Script for image preview and validation -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // File preview functionality
    function setupFilePreview(fileInput, previewElement) {
      fileInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            previewElement.style.backgroundImage = `url(${e.target.result})`;
            previewElement.classList.add('has-image');
            previewElement.querySelector('.card-preview-text').style.display = 'none';
          }
          reader.readAsDataURL(file);
        } else {
          previewElement.style.backgroundImage = 'none';
          previewElement.classList.remove('has-image');
          previewElement.querySelector('.card-preview-text').style.display = 'block';
        }
      });
    }
    
    // Setup front and back previews
    setupFilePreview(document.getElementById('card-front'), document.getElementById('front-preview'));
    setupFilePreview(document.getElementById('card-back'), document.getElementById('back-preview'));
    
    // Toggle back side upload based on checkbox
    const blankBackCheckbox = document.getElementById('blank-back');
    const cardBackInput = document.getElementById('card-back');
    const backPreview = document.getElementById('back-preview');
    
    blankBackCheckbox.addEventListener('change', function() {
      cardBackInput.disabled = this.checked;
      if (this.checked) {
        cardBackInput.value = '';
        backPreview.classList.remove('has-image');
        backPreview.style.backgroundImage = '';
        backPreview.innerHTML = '<span class="card-preview-text">Back side is blank</span>';
      } else {
        backPreview.innerHTML = '<span class="card-preview-text">Preview will appear here</span>';
      }
    });
    
    // State-county-city dynamic selection would be implemented here
    // For the demo, we'll simulate this with some basic functionality
    const stateSelect = document.getElementById('state');
    const countySelect = document.getElementById('county');
    const citySelect = document.getElementById('city');
    
    stateSelect.addEventListener('change', function() {
      if (this.value) {
        countySelect.disabled = false;
        // Here you would typically load counties via AJAX
        // For demo purposes, we'll add placeholder counties
        countySelect.innerHTML = '<option value="">Select County</option><option value="county1">Sample County 1</option><option value="county2">Sample County 2</option>';
      } else {
        countySelect.disabled = true;
        countySelect.innerHTML = '<option value="">Select County</option>';
        citySelect.disabled = true;
        citySelect.innerHTML = '<option value="">Select City</option>';
      }
    });
    
    countySelect.addEventListener('change', function() {
      if (this.value) {
        citySelect.disabled = false;
        // Here you would typically load cities via AJAX
        // For demo purposes, we'll add placeholder cities
        citySelect.innerHTML = '<option value="">Select City</option><option value="city1">Sample City 1</option><option value="city2">Sample City 2</option>';
      } else {
        citySelect.disabled = true;
        citySelect.innerHTML = '<option value="">Select City</option>';
      }
    });
    
    // Form validation
    document.querySelector('.profile-form').addEventListener('submit', function(e) {
      let valid = true;
      const requiredInputs = this.querySelectorAll('[required]');
      
      requiredInputs.forEach(input => {
        if (!input.value && !input.disabled) {
          valid = false;
          input.classList.add('error');
        } else {
          input.classList.remove('error');
        }
      });
      
      // Validate product categories
      const categoryCheckboxes = document.querySelectorAll('input[name="product_categories"]:checked');
      if (categoryCheckboxes.length === 0) {
        valid = false;
        // Show error message for categories
        alert('Please select at least one product category.');
      }
      
      if (!valid) {
        e.preventDefault();
        window.scrollTo(0, 0);
      }
    });
  });
</script>
{% endblock %}