{% extends "base.html" %}
{% load static %}

{% block title %}Business Directory 2.0 - Find Local Businesses & Handymen{% endblock %}

{% block extra_css %}
<style>
  .search-btn.active {
    animation: pulse-button 2s infinite;
  }
  
  @keyframes pulse-button {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }
  
  /* Categories styling */
  .category-container {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 20px;
    margin-top: 30px;
  }
  
  .category-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 25px 15px;
    background-color: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    cursor: pointer;
    transition: var(--transition);
  }
  
  .category-item:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
  }
  
  .category-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
  }
  
  .category-item h3 {
    font-size: 1.1rem;
    color: var(--dark-gray);
    margin: 0;
    text-align: center;
  }
  
  @media (max-width: 1200px) {
    .category-container {
      grid-template-columns: repeat(4, 1fr);
    }
  }
  
  @media (max-width: 768px) {
    .category-container {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  @media (max-width: 576px) {
    .category-container {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>
{% endblock %}

{% block content %}
  <!-- Banner -->
  <div class="banner">
    <div class="banner-content">
      <h1>Business Directory 2.0</h1>
      <p>Find local businesses and exclusive discounts all in one place. Connect with trusted handymen and service providers in your area.</p>
    </div>
  </div>

  <!-- Search Section -->
  <section class="search-section">
    <div class="search-container">
      <div class="search-box">
        <label for="country">Country</label>
        <select id="country">
          <option value="">Select Country</option>
          <!-- Will be populated by JavaScript -->
        </select>
      </div>
      <div class="search-box">
        <label for="state">State/Province</label>
        <select id="state" disabled>
          <option value="">Select State</option>
          <!-- Will be populated by JavaScript -->
        </select>
      </div>
      <div class="search-box">
        <label for="city">City</label>
        <select id="city" disabled>
          <option value="">Select City</option>
          <!-- Will be populated by JavaScript -->
        </select>
      </div>
      <button class="search-btn">
        Search
      </button>
    </div>
  </section>

  <!-- Business Cards Section -->
  <section class="business-cards-section">
    <h2 class="section-title">Featured Businesses</h2>
    
    <div class="business-cards-container">
      <!-- Card 1 -->
      <div class="business-card-wrapper">
        <div class="business-card" id="card1">
          <div class="business-card-front">
            <div class="card-image-container">
              <img src="{% static 'images/bd.jpg' %}" alt="John's Plumbing Business Card" class="card-image">
            </div>
            <h3 class="card-title">John's Plumbing</h3>
            <p class="card-description">Professional plumbing services for all your needs. Emergency repairs, installations, and maintenance.</p>
            <a href="https://johnsplumbing.com" class="card-website">johnsplumbing.com</a>
            <div class="promo-indicator active"></div>
            <div class="promo-code">SAVE20</div>
          </div>
          <div class="business-card-back">
            <h3 class="card-title">Contact Details | Plumbing</h3>
            <p class="card-description">
              Phone: (555) 123-4567<br>
              Email: info@johnsplumbing.com<br>
              Hours: Mon-Fri 8am-6pm<br>
              Services: Repairs, Installations, Maintenance<br>
              Licensed & Insured
            </p>
          </div>
        </div>
        <button class="flip-label" data-card="card1">Back Side</button>
      </div>
      
      <!-- Card 2 -->
      <div class="business-card-wrapper">
        <div class="business-card" id="card2">
          <div class="business-card-front">
            <div class="card-image-container">
              <img src="{% static 'images/bd.jpg' %}" alt="Elite Electrical Business Card" class="card-image">
            </div>
            <h3 class="card-title">Elite Electrical</h3>
            <p class="card-description">Residential and commercial electrical services. Wiring, installations, repairs, and inspections.</p>
            <a href="https://eliteelectrical.com" class="card-website">eliteelectrical.com</a>
            <div class="promo-indicator"></div>
          </div>
          <div class="business-card-back">
            <h3 class="card-title">Contact Details | Electrical</h3>
            <p class="card-description">
              Phone: (555) 987-6543<br>
              Email: service@eliteelectrical.com<br>
              Hours: Mon-Sat 7am-7pm<br>
              Services: Wiring, Installations, Repairs<br>
              24/7 Emergency Service
            </p>
          </div>
        </div>
        <button class="flip-label" data-card="card2">Back Side</button>
      </div>
      
      <!-- Card 3 -->
      <div class="business-card-wrapper">
        <div class="business-card" id="card3">
          <div class="business-card-front">
            <div class="card-image-container">
              <img src="{% static 'images/bd.jpg' %}" alt="Mike's Home Repair Business Card" class="card-image">
            </div>
            <h3 class="card-title">Mike's Home Repair</h3>
            <p class="card-description">General repairs, carpentry, drywall, painting, and more. Quality craftsmanship guaranteed.</p>
            <a href="https://mikeshomerepair.com" class="card-website">mikeshomerepair.com</a>
            <div class="promo-indicator active"></div>
            <div class="promo-code">FIRST15</div>
          </div>
          <div class="business-card-back">
            <h3 class="card-title">Contact Details | Home Repair</h3>
            <p class="card-description">
              Phone: (555) 234-5678<br>
              Email: mike@mikeshomerepair.com<br>
              Hours: Mon-Fri 8am-5pm<br>
              Services: Carpentry, Drywall, Painting<br>
              Free Estimates
            </p>
          </div>
        </div>
        <button class="flip-label" data-card="card3">Back Side</button>
      </div>
      
      <!-- Card 4 -->
      <div class="business-card-wrapper">
        <div class="business-card" id="card4">
          <div class="business-card-front">
            <div class="card-image-container">
              <img src="{% static 'images/bd.jpg' %}" alt="Green Landscaping Business Card" class="card-image">
            </div>
            <h3 class="card-title">Green Landscaping</h3>
            <p class="card-description">Professional landscaping and lawn maintenance services. Garden design, irrigation, and seasonal care.</p>
            <a href="https://greenlandscaping.com" class="card-website">greenlandscaping.com</a>
            <div class="promo-indicator"></div>
          </div>
          <div class="business-card-back">
            <h3 class="card-title">Contact Details | Landscaping</h3>
            <p class="card-description">
              Phone: (555) 876-5432<br>
              Email: info@greenlandscaping.com<br>
              Hours: Mon-Sun 7am-7pm<br>
              Services: Landscaping, Lawn Care, Garden Design<br>
              Eco-friendly Methods
            </p>
          </div>
        </div>
        <button class="flip-label" data-card="card4">Back Side</button>
      </div>
      
      <!-- Card 5 -->
      <div class="business-card-wrapper">
        <div class="business-card" id="card5">
          <div class="business-card-front">
            <div class="card-image-container">
              <img src="{% static 'images/bd.jpg' %}" alt="Pro HVAC Services Business Card" class="card-image">
            </div>
            <h3 class="card-title">Pro HVAC Services</h3>
            <p class="card-description">Heating, ventilation, and air conditioning specialists. Installation, repair, and maintenance.</p>
            <a href="https://prohvac.com" class="card-website">prohvac.com</a>
            <div class="promo-indicator active"></div>
            <div class="promo-code">COOL25</div>
          </div>
          <div class="business-card-back">
            <h3 class="card-title">Contact Details | HVAC</h3>
            <p class="card-description">
              Phone: (555) 345-6789<br>
              Email: service@prohvac.com<br>
              Hours: Mon-Fri 8am-8pm, Sat 9am-5pm<br>
              Services: HVAC Installation, Repair, Maintenance<br>
              Energy-efficient Solutions
            </p>
          </div>
        </div>
        <button class="flip-label" data-card="card5">Back Side</button>
      </div>
      
      <!-- Card 6 -->
      <div class="business-card-wrapper">
        <div class="business-card" id="card6">
          <div class="business-card-front">
            <div class="card-image-container">
              <img src="{% static 'images/bd.jpg' %}" alt="Superior Roofing Business Card" class="card-image">
            </div>
            <h3 class="card-title">Superior Roofing</h3>
            <p class="card-description">Complete roofing solutions. Repairs, installations, inspections, and maintenance for all roof types.</p>
            <a href="https://superiorroofing.com" class="card-website">superiorroofing.com</a>
            <div class="promo-indicator active"></div>
            <div class="promo-code">ROOF10</div>
          </div>
          <div class="business-card-back">
            <h3 class="card-title">Contact Details | Roofing</h3>
            <p class="card-description">
              Phone: (555) 456-7890<br>
              Email: info@superiorroofing.com<br>
              Hours: Mon-Fri 7am-6pm<br>
              Services: Roof Repair, Installation, Inspection<br>
              10-Year Warranty
            </p>
          </div>
        </div>
        <button class="flip-label" data-card="card6">Back Side</button>
      </div>
      
      <!-- Card 7 -->
      <div class="business-card-wrapper">
        <div class="business-card" id="card7">
          <div class="business-card-front">
            <div class="card-image-container">
              <img src="{% static 'images/bd.jpg' %}" alt="Clean Team Cleaning" class="card-image">
            </div>
            <h3 class="card-title">Clean Team</h3>
            <p class="card-description">Professional cleaning services for residential and commercial properties. Regular and deep cleaning options.</p>
            <a href="https://cleanteam.com" class="card-website">cleanteam.com</a>
            <div class="promo-indicator active"></div>
            <div class="promo-code">CLEAN50</div>
          </div>
          <div class="business-card-back">
            <h3 class="card-title">Contact Details | Cleaning</h3>
            <p class="card-description">
              Phone: (555) 567-8901<br>
              Email: bookings@cleanteam.com<br>
              Hours: Mon-Sat 8am-6pm<br>
              Services: Residential, Commercial, Move-in/out<br>
              Eco-friendly products available
            </p>
          </div>
        </div>
        <button class="flip-label" data-card="card7">Back Side</button>
      </div>
      
      <!-- Card 8 -->
      <div class="business-card-wrapper">
        <div class="business-card" id="card8">
          <div class="business-card-front">
            <div class="card-image-container">
              <img src="{% static 'images/bd.jpg' %}" alt="TechFix IT Services" class="card-image">
            </div>
            <h3 class="card-title">TechFix IT</h3>
            <p class="card-description">Computer repair, network setup, and IT consulting for homes and small businesses. Fast and reliable service.</p>
            <a href="https://techfix.com" class="card-website">techfix.com</a>
            <div class="promo-indicator"></div>
          </div>
          <div class="business-card-back">
            <h3 class="card-title">Contact Details | IT Services</h3>
            <p class="card-description">
              Phone: (555) 678-9012<br>
              Email: help@techfix.com<br>
              Hours: Mon-Fri 9am-7pm, Sat 10am-4pm<br>
              Services: Computer Repair, Network, Data Recovery<br>
              Remote support available
            </p>
          </div>
        </div>
        <button class="flip-label" data-card="card8">Back Side</button>
      </div>
      
      <!-- Card 9 -->
      <div class="business-card-wrapper">
        <div class="business-card" id="card9">
          <div class="business-card-front">
            <div class="card-image-container">
              <img src="{% static 'images/bd.jpg' %}" alt="City Movers" class="card-image">
            </div>
            <h3 class="card-title">City Movers</h3>
            <p class="card-description">Professional moving services for local and long-distance relocations. Packing, loading, and storage solutions.</p>
            <a href="https://citymovers.com" class="card-website">citymovers.com</a>
            <div class="promo-indicator active"></div>
            <div class="promo-code">MOVE100</div>
          </div>
          <div class="business-card-back">
            <h3 class="card-title">Contact Details | Moving Services</h3>
            <p class="card-description">
              Phone: (555) 789-0123<br>
              Email: booking@citymovers.com<br>
              Hours: Mon-Sun 8am-8pm<br>
              Services: Local & Long Distance, Packing, Storage<br>
              Free in-home estimates
            </p>
          </div>
        </div>
        <button class="flip-label" data-card="card9">Back Side</button>
      </div>
      
      <!-- Card 10 -->
      <div class="business-card-wrapper">
        <div class="business-card" id="card10">
          <div class="business-card-front">
            <div class="card-image-container">
              <img src="{% static 'images/bd.jpg' %}" alt="Quick Locksmith" class="card-image">
            </div>
            <h3 class="card-title">Quick Locksmith</h3>
            <p class="card-description">24/7 emergency locksmith services. Lock installation, repair, key duplication, and security consultations.</p>
            <a href="https://quicklocksmith.com" class="card-website">quicklocksmith.com</a>
            <div class="promo-indicator active"></div>
            <div class="promo-code">LOCK15</div>
          </div>
          <div class="business-card-back">
            <h3 class="card-title">Contact Details | Locksmith</h3>
            <p class="card-description">
              Phone: (555) 890-1234<br>
              Email: service@quicklocksmith.com<br>
              Hours: 24/7 Emergency Service<br>
              Services: Locks, Keys, Safes, Security Systems<br>
              15-minute emergency response
            </p>
          </div>
        </div>
        <button class="flip-label" data-card="card10">Back Side</button>
      </div>
    </div>
  </section>

  <!-- Featured Categories Section -->
  <section class="business-cards-section">
    <h2 class="section-title">Browse Categories</h2>
    
    <div class="category-container">
      <div class="category-item">
        <div class="category-icon">🔧</div>
        <h3>Plumbing</h3>
      </div>
      <div class="category-item">
        <div class="category-icon">⚡</div>
        <h3>Electrical</h3>
      </div>
      <div class="category-item">
        <div class="category-icon">🏠</div>
        <h3>Home Repair</h3>
      </div>
      <div class="category-item">
        <div class="category-icon">🌱</div>
        <h3>Landscaping</h3>
      </div>
      <div class="category-item">
        <div class="category-icon">❄️</div>
        <h3>HVAC</h3>
      </div>
      <div class="category-item">
        <div class="category-icon">🏗️</div>
        <h3>Roofing</h3>
      </div>
    </div>
  </section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/address_dropdowns.js' %}"></script>
<script>
  document.addEventListener('DOMContentLoaded', async function() {
    // Load countries from API
    const countryDropdown = document.getElementById('country');
    
    try {
      const response = await fetch('/api/countries/');
      if (!response.ok) {
        throw new Error('Failed to fetch countries');
      }
      
      const countries = await response.json();
      
      // Add countries to dropdown
      countries.forEach(country => {
        const option = document.createElement('option');
        option.value = country.iso2;
        option.textContent = country.name;
        countryDropdown.appendChild(option);
      });
    } catch (error) {
      console.error('Error loading countries:', error);
    }
    
    // Make categories clickable
    document.querySelectorAll('.category-item').forEach(item => {
      item.addEventListener('click', function() {
        const category = this.querySelector('h3').innerText;
        showNotification(`Browsing ${category} businesses`);
      });
    });
    
    // Make search button handle form submission
    const searchBtn = document.querySelector('.search-btn');
    if (searchBtn) {
      searchBtn.addEventListener('click', function() {
        const country = document.getElementById('country').value;
        const state = document.getElementById('state').value;
        const city = document.getElementById('city').value;
        
        if (country || state || city) {
          // Create a form to submit the search
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = '/handyman/'; // Assuming this is the search endpoint
          
          // Add CSRF token
          const csrfInput = document.createElement('input');
          csrfInput.type = 'hidden';
          csrfInput.name = 'csrfmiddlewaretoken';
          csrfInput.value = document.querySelector('[name=csrfmiddlewaretoken]').value;
          form.appendChild(csrfInput);
          
          // Add search parameters
          if (country) {
            const countryInput = document.createElement('input');
            countryInput.type = 'hidden';
            countryInput.name = 'country';
            countryInput.value = country;
            form.appendChild(countryInput);
          }
          
          if (state) {
            const stateInput = document.createElement('input');
            stateInput.type = 'hidden';
            stateInput.name = 'state';
            stateInput.value = state;
            form.appendChild(stateInput);
          }
          
          if (city) {
            const cityInput = document.createElement('input');
            cityInput.type = 'hidden';
            cityInput.name = 'city';
            cityInput.value = city;
            form.appendChild(cityInput);
          }
          
          // Append form to document and submit
          document.body.appendChild(form);
          form.submit();
        } else {
          // Show notification if no search criteria selected
          showNotification('Please select at least one search criteria');
        }
      });
    }
  });
</script>
{% endblock %}